<!-- comments-section.component.html -->
<div class="comments-reactions-container">

  <!-- ============================================
       REACTIONS SECTION
       ============================================ -->
  <div class="reactions-section">
    <div class="reactions-header">
      <h3 class="section-title">Reactions</h3>
      <span class="total-reactions">{{ totalReactions }} reactions</span>
    </div>

    <!-- Top Reactions Display -->
    <div class="top-reactions">
      <div class="reaction-item"
           *ngFor="let reaction of getTopReactions()"
           [class.has-reacted]="reaction.hasReacted"
           (click)="onReactionClick(reaction)">
        <span class="reaction-emoji">{{ reaction.emoji }}</span>
        <span class="reaction-count">{{ reaction.count }}</span>
      </div>

      <!-- Add Reaction Button -->
      <button class="add-reaction-btn" (click)="toggleReactionPicker()">
        <span class="plus-icon">+</span>
      </button>
    </div>

    <!-- Reaction Picker Popup -->
    <div class="reaction-picker" *ngIf="showReactionPicker">
      <div class="reaction-picker-item"
           *ngFor="let reaction of reactions"
           [class.has-reacted]="reaction.hasReacted"
           (click)="onReactionClick(reaction)">
        <span class="picker-emoji">{{ reaction.emoji }}</span>
        <span class="picker-label">{{ reaction.name }}</span>
        <span class="picker-count">{{ reaction.count }}</span>
      </div>
    </div>
  </div>

  <!-- ============================================
       COMMENTS SECTION
       ============================================ -->
  <div class="comments-section">
    <div class="comments-header">
      <h3 class="section-title">Comments</h3>
      <span class="comment-count">{{ comments.length }} comments</span>
    </div>

    <!-- Add Comment Form -->
    <div class="add-comment-form">
      <div class="comment-input-wrapper">
        <div class="user-avatar-small">CU</div>
        <textarea
          class="comment-input"
          [(ngModel)]="newComment"
          placeholder="Add your comment..."
          rows="3"></textarea>
      </div>
      <div class="comment-form-actions">
        <button
          class="submit-comment-btn"
          (click)="onSubmitComment()"
          [disabled]="!newComment.trim()">
          Post Comment
        </button>
      </div>
    </div>

    <!-- Comments List -->
    <div class="comments-list">
      <div class="comment-item" *ngFor="let comment of comments">
        <!-- Comment Header -->
        <div class="comment-header">
          <div class="comment-author-info">
            <div class="comment-avatar">
              {{ getAuthorInitials(comment.author.firstName, comment.author.lastName) }}
            </div>
            <div class="comment-meta">
              <span class="comment-author-name">
                {{ getAuthorFullName(comment.author) }}
              </span>
              <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
            </div>
          </div>
          <button class="comment-menu-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1"></circle>
              <circle cx="12" cy="5" r="1"></circle>
              <circle cx="12" cy="19" r="1"></circle>
            </svg>
          </button>
        </div>

        <!-- Comment Content -->
        <div class="comment-content">
          <p>{{ comment.content }}</p>
        </div>

        <!-- Comment Actions -->
        <div class="comment-actions">
          <button
            class="comment-action-btn"
            [class.active]="comment.hasLiked"
            (click)="onLikeComment(comment)">
            <svg width="18" height="18" viewBox="0 0 24 24" [attr.fill]="comment.hasLiked ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span>{{ comment.likes > 0 ? comment.likes : 'Like' }}</span>
          </button>
          <button
            class="comment-action-btn"
            (click)="toggleReply(comment)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 17 4 12 9 7"></polyline>
              <path d="M20 18v-2a4 4 0 0 0-4-4H4"></path>
            </svg>
            <span>Reply</span>
          </button>
        </div>

        <!-- Reply Form -->
        <div class="reply-form" *ngIf="comment.isReplying">
          <div class="comment-input-wrapper reply-input-wrapper">
            <div class="user-avatar-small">CU</div>
            <textarea
              class="comment-input"
              [(ngModel)]="replyText[comment.id]"
              placeholder="Write a reply..."
              rows="2"></textarea>
          </div>
          <div class="reply-form-actions">
            <button
              class="cancel-reply-btn"
              (click)="toggleReply(comment)">
              Cancel
            </button>
            <button
              class="submit-reply-btn"
              (click)="onSubmitReply(comment)"
              [disabled]="!replyText[comment.id]?.trim()">
              Reply
            </button>
          </div>
        </div>

        <!-- Replies -->
        <div class="replies-container" *ngIf="comment.replies && comment.replies.length > 0">
          <div class="reply-item" *ngFor="let reply of comment.replies">
            <div class="comment-header">
              <div class="comment-author-info">
                <div class="comment-avatar reply-avatar">
                  {{ getAuthorInitials(reply.author.firstName, reply.author.lastName) }}
                </div>
                <div class="comment-meta">
                  <span class="comment-author-name">
                    {{ getAuthorFullName(reply.author) }}
                  </span>
                  <span class="comment-date">{{ formatDate(reply.createdAt) }}</span>
                </div>
              </div>
            </div>

            <div class="comment-content">
              <p>{{ reply.content }}</p>
            </div>

            <div class="comment-actions">
              <button
                class="comment-action-btn"
                [class.active]="reply.hasLiked"
                (click)="onLikeComment(reply)">
                <svg width="16" height="16" viewBox="0 0 24 24" [attr.fill]="reply.hasLiked ? 'currentColor' : 'none'" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
                <span>{{ reply.likes > 0 ? reply.likes : 'Like' }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-comments" *ngIf="comments.length === 0">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <h4>No comments yet</h4>
      <p>Be the first to share your thoughts!</p>
    </div>
  </div>
</div>
